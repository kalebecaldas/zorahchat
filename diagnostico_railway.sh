#!/bin/bash

# Script de Diagn√≥stico Railway - ZORAH CHAT
# Como o Railway n√£o tem SSH, use os logs do Dashboard

echo "üîç DIAGN√ìSTICO RAILWAY - ZORAH CHAT"
echo "=================================="
echo ""
echo "‚ö†Ô∏è  O Railway N√ÉO tem acesso SSH direto."
echo "     Use este guia para diagnosticar pelos LOGS do Dashboard."
echo ""

echo "üìã CHECKLIST DE DIAGN√ìSTICO - FRONTEND"
echo "======================================"
echo ""

echo "1Ô∏è‚É£  VER LOGS DO FRONTEND"
echo "   Railway ‚Üí Frontend (zorahchat) ‚Üí Deployments ‚Üí View Logs"
echo ""
echo "   Procure por estes erros:"
echo "   ‚ùå 'Error: Cannot find module'"
echo "   ‚ùå 'ENOENT: no such file'"
echo "   ‚ùå 'npm ERR!'"
echo "   ‚ùå 'command not found'"
echo "   ‚ùå 'Port already in use'"
echo ""

echo "2Ô∏è‚É£  VERIFICAR BUILD"
echo "   Nos logs, procure:"
echo "   ‚úÖ 'vite v7.x.x building for production...'"
echo "   ‚úÖ '‚úì XXX modules transformed'"
echo "   ‚úÖ '‚úì built in XXXms'"
echo ""
echo "   Se N√ÉO aparecer, o BUILD FALHOU!"
echo ""

echo "3Ô∏è‚É£  VERIFICAR START"
echo "   Nos logs, procure:"
echo "   ‚úÖ 'Local:   http://localhost:XXXX'"
echo "   ‚úÖ 'Network: use --host to expose'"
echo ""
echo "   Se N√ÉO aparecer, o START FALHOU!"
echo ""

echo "4Ô∏è‚É£  VERIFICAR CONFIGURA√á√ïES"
echo "   Railway ‚Üí Frontend ‚Üí Settings:"
echo ""
echo "   Root Directory:  frontend  (sem /)"
echo "   Build Command:   npm run build"
echo "   Start Command:   npm start"
echo ""

echo "5Ô∏è‚É£  VERIFICAR VARI√ÅVEIS"
echo "   Railway ‚Üí Frontend ‚Üí Variables:"
echo ""
echo "   VITE_API_URL=https://backend-chat-zorah-faturamento-laam.up.railway.app"
echo "   VITE_WS_URL=https://backend-chat-zorah-faturamento-laam.up.railway.app"
echo ""

echo ""
echo "üìã CHECKLIST DE DIAGN√ìSTICO - BACKEND"
echo "======================================"
echo ""

echo "1Ô∏è‚É£  VER LOGS DO BACKEND"
echo "   Railway ‚Üí Backend ‚Üí Deployments ‚Üí View Logs"
echo ""
echo "   Procure por:"
echo "   ‚úÖ '[DATABASE] Using database at: /app/data/database.sqlite'"
echo "   ‚úÖ 'Database initialized.'"
echo "   ‚úÖ 'Seeding IAAM workspace...'"
echo "   ‚úÖ 'Server running on http://localhost:3001'"
echo ""

echo "2Ô∏è‚É£  VERIFICAR VOLUME"
echo "   Railway ‚Üí Backend ‚Üí Data/Volumes"
echo ""
echo "   Deve ter um volume:"
echo "   Mount Path: /app/data"
echo "   Size: 1GB"
echo ""
echo "   Se N√ÉO tiver, CRIE AGORA!"
echo ""

echo "3Ô∏è‚É£  VERIFICAR VARI√ÅVEIS"
echo "   Railway ‚Üí Backend ‚Üí Variables:"
echo ""
echo "   ‚úÖ PORT=3001"
echo "   ‚úÖ JWT_SECRET=[seu_secret]"
echo "   ‚úÖ NODE_ENV=production"
echo "   ‚úÖ FRONTEND_URL=https://zorahchat-zorah-faturamento-iaam.up.railway.app"
echo ""
echo "   REMOVER (se existir):"
echo "   ‚ùå DATABASE_PUBLIC_URL"
echo "   ‚ùå FRONTEND_PORT"
echo ""

echo ""
echo "üîß SOLU√á√ïES R√ÅPIDAS"
echo "==================="
echo ""

echo "PROBLEMA: Build do frontend falha"
echo "SOLU√á√ÉO: Verifique se todas as depend√™ncias est√£o no package.json"
echo "         Veja os logs exatos do erro de build"
echo ""

echo "PROBLEMA: Frontend n√£o inicia (502)"
echo "SOLU√á√ÉO 1: Commit o c√≥digo atualizado e redeploy"
echo "SOLU√á√ÉO 2: Verifique Start Command = 'npm start'"
echo "SOLU√á√ÉO 3: Veja logs para erro espec√≠fico"
echo ""

echo "PROBLEMA: Backend n√£o conecta ao banco"
echo "SOLU√á√ÉO: Adicione Volume em /app/data"
echo "         Veja logs para 'ENOENT' ou 'database not found'"
echo ""

echo "PROBLEMA: CORS error"
echo "SOLU√á√ÉO: Verifique FRONTEND_URL no backend"
echo "         Deve ser a URL COMPLETA do frontend"
echo ""

echo ""
echo "‚ö° A√á√ïES IMEDIATAS"
echo "=================="
echo ""

echo "1. Commit c√≥digo atualizado:"
echo "   git add ."
echo "   git commit -m 'Corrigir porta do frontend'"
echo "   git push"
echo ""

echo "2. Railway ‚Üí Frontend ‚Üí Redeploy"
echo ""

echo "3. Railway ‚Üí Backend ‚Üí Redeploy"
echo ""

echo "4. Aguardar 2-3 minutos"
echo ""

echo "5. Verificar logs novamente"
echo ""

echo ""
echo "üìû COMO OBTER AJUDA"
echo "==================="
echo ""

echo "Se ainda n√£o funcionar, me envie:"
echo ""
echo "1. Screenshot dos LOGS do Frontend (√∫ltimas 50 linhas)"
echo "2. Screenshot dos LOGS do Backend (√∫ltimas 50 linhas)"
echo "3. Screenshot das VARI√ÅVEIS do Frontend"
echo "4. Screenshot das VARI√ÅVEIS do Backend"
echo "5. Screenshot da configura√ß√£o de VOLUMES do Backend"
echo ""

echo "Com essas informa√ß√µes, posso diagnosticar exatamente o problema!"
echo ""

echo "=================================="
echo "Diagn√≥stico completo!"
echo "Siga os passos acima e me avise."
echo "=================================="
